clear,close all,clc
addpath('/home/lab5254/Desktop/')
bag = rosbag('2019-06-30-21-54-04.bag');

scanSel = select(bag,'Topic','/scan');
scan = readMessages(scanSel);
scants = timeseries(scanSel);

%  c=120;
%  a =round( 97/c*length(scan));
%  b = round( 107/c*length(scan));
%% read SICK laserscan

%  for i = a:2:b
%     ranges = scan{i,1}.Ranges;
%     angles = scan{i,1}.readScanAngles;
%
%
%     for k=1:length(scan{i, 1}.Intensities)
%         if scan{i, 1}.Intensities(k,1) < 200
%
%              scan{i,1}.Ranges(k,1)=single(Inf);
%
%         end
%
%     end
%      plot(scan{i,1}),hold on,axis equal
% %      i
% end

%% read velodyne laserscan
scanSel = select(bag,'Topic','/velodyne_points');

scan=readMessages(scanSel);


c = 59;
start =round( 30/c*length(scan));
b = round( 31/c*length(scan));

figure
xmin = -10;xmax=10;
for i=start:b
    i
    %     a{i} = readXYZ(scan{i});
    a = readXYZ(scan{i});

%      pcshow(a(5000:20000,:))
     for g=1:length(a)
         g
%         if a(g,3) >0
             if a(g,1) >xmin && a(g,1) <xmax && a(g,2) >-10 && a(g,2) <10
                 
                    plot(a(g,1),a(g,2),'.'),
                    hold on
%                 end
             end
         end
%         g
%     end
end
axis equal,